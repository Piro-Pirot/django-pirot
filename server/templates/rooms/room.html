{% extends 'base.html' %}
{% load static %}

{% block content %}

<div class="chat-name">{{ title }} 채팅 방</div>
<div class="chat-container">
    <div class="conversation">
    </div>
    <div class="chat-input">
        <input type="text" class="input">
        <button type="button" onclick="onClickSendMessage('{{ user }}', '{{ room_uuid }}')">SEND</button>
    </div>
    <div class="board"></div>
</div>


{% endblock %}

{% block extra %}

<script src="{% static 'js/chat/socketClient.js' %}"></script>

<script>
    jsonBubbles = {{jsonBubbles | safe}};

    let bubbleList = [];

    jsonBubbles.forEach(element => {
        bubbleList.push(element['fields']);
    });


    // 말풍선을 담을 곳
    let converations = document.querySelector('.conversation');

    // 말풍선을 만드는 코드
    function createBubble(bubbleData) {
        let bubbleDiv = document.createElement('div');
        let bubbleContainer = document.createElement('div');

        if(bubbleData['user'] === '{{ user.id }}') {
            // 로그인 사용자의 말풍선인 경우
            bubbleDiv.classList.add('bubble-box-me');
            bubbleContainer.classList.add('bubble-container-me');
        }
        else {
            bubbleDiv.classList.add('bubble-box');
            bubbleContainer.classList.add('bubble-container');
        }

        // 사진, 이름
        let bubbleHeader = document.createElement('div');
        bubbleHeader.classList.add('bubble-header');

        let profileImg = document.createElement('img');
        profileImg.setAttribute('src', bubbleData['profile_img']);

        let nameLabel = document.createElement('label');
        nameLabel.innerText = bubbleData['nickname'];
        nameLabel.classList.add('bubble-username');

        bubbleHeader.appendChild(profileImg);
        bubbleHeader.appendChild(nameLabel);

        // 내용
        let bubbleContent = document.createElement('div');
        bubbleContent.classList.add('bubble-content');
        bubbleContent.innerText = bubbleData['content'];

        bubbleContainer.appendChild(bubbleHeader);
        bubbleContainer.appendChild(bubbleContent);

        bubbleDiv.appendChild(bubbleContainer);

        // 화면에 추가
        converations.appendChild(bubbleDiv);
    }

    bubbleList.forEach(element => createBubble(element));
</script>

{% endblock %}