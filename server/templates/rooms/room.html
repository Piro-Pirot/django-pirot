{% extends 'base.html' %}
{% load static %}

{% block content %}

<div class="chat-name">
    <div class="chat-name-container">
        <div class="orange-stick">
        </div>
        <div class="chat-name-content">
            <div class="chat-name-name">
                {{ title }}
            </div>
            <div class="chat-name-icons">
                <input id="chat-name-search" type="text">
                <i id="chat-search-btn" class="fa-solid fa-magnifying-glass"></i>
                <i class="ri-settings-3-line"></i>
            </div>
        </div>
    </div>
</div>
<div class="chat-container">
    <div class="chat-conversation-container">
        <div class="conversation"></div>
        <div class="chat-input">
            <input type="text" class="input" onkeypress="if(event.keyCode==13) {onClickSendMessage('{{ user }}', '{{ room.id }}');}">
            <button type="button" onclick="onClickSendMessage('{{ user }}', '{{ room.id }}')">SEND</button>
        </div>
    </div>
    <div class="board-container">
        <div class="board"></div>
        <div class="post-input">
            <input type="text" class="post">
            <button type="button" onclick="onClickSendPost('{{ user }}', '{{ room.id }}')">작성</button>
        </div>
    </div>
</div>


{% endblock %}

{% block extra %}

<script>
    let bubbleList = [];
    if(`{{ jsonBubbles | safe}}` !== '') {
        let jsonBubbles = {{jsonBubbles | safe}};
        
        jsonBubbles.forEach(element => {
            bubbleList.push(element);
        });
    }
    
    // js에서 필요한 정보
    let curUsername = '{{ user }}';
    let curUserId = '{{ user.id }}';
    let curChannelId = {{ channel.id }};
    let curRoomId = {{ room.id }};
    let curRoomType = {{ room.room_type }};

    // 말풍선을 담을 곳
    let converations = document.querySelector('.conversation');


    // let happyList = [];
    // if(`{{ jsonHappys | safe}}` !== '') {
    //     let jsonHappys = {{jsonHappys | safe}};
        
    //     jsonHappys.forEach(element => {
    //         happyList.push(element);
    //     });

    let postList = [];
    if(`{{ jsonPosts | safe}}` !== '') {
        let jsonPosts = {{jsonPosts | safe}};
        
        jsonPosts.forEach(element => {
            postid = element['id']
            // postid = element['id']
            // if happylist의 post__id가 postid이면 count++
            // count값을 'happyCount'라는 키값으로 리스트에 저장.
            postList.push(element);
        });
        // postList의 형태는 [포스트1정보, 포스트2정보, 포스트3정보, ...] 여기서 차례대로 post id 정보만 빼온다.
        // 그 후 Happy object 역참조할랬는데 되나? 아 그러면 따로 받아와서..
        
    }


    // 게시글을 담을 곳
    let posts = document.querySelector('.board');
</script>

<script src="{% static 'js/chat/room.js' %}"></script>
<script src="{% static 'js/chat/bubble.js' %}"></script>
<script src="{% static 'js/chat/post.js' %}"></script>
<script src="{% static 'js/chat/socketClient.js' %}"></script>

{% endblock %}